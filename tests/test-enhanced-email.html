<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Enhanced Email System - Chess Club</title>
    <style>
        :root {
            --primary: #1A6E70;
            --primary-light: #399996;
            --secondary: #274c7d;
            --background: #f5f0e1;
            --success: #10b981;
            --warning: #f97316;
            --error: #ef4444;
        }
        
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 30px auto;
            padding: 20px;
            background: var(--background);
            color: #1f2937;
        }
        .container {
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 4px 25px rgba(0,0,0,0.1);
        }
        h1 {
            color: var(--primary);
            margin-top: 0;
            border-bottom: 3px solid var(--primary);
            padding-bottom: 15px;
        }
        .test-section {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 25px;
            margin: 25px 0;
        }
        .test-section h3 {
            color: var(--secondary);
            margin-top: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        button {
            background: var(--primary);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            margin: 10px 10px 10px 0;
        }
        button:hover {
            background: var(--primary-light);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(57, 153, 150, 0.4);
        }
        button:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        .info-box {
            background: #e0f2f2;
            border-left: 4px solid var(--primary);
            padding: 20px;
            margin: 20px 0;
            border-radius: 6px;
        }
        .success-box {
            background: #d1fae5;
            border-left: 4px solid var(--success);
            padding: 20px;
            margin: 20px 0;
            border-radius: 6px;
            color: #065f46;
        }
        .error-box {
            background: #fee2e2;
            border-left: 4px solid var(--error);
            padding: 20px;
            margin: 20px 0;
            border-radius: 6px;
            color: #991b1b;
        }
        .warning-box {
            background: #fff7ed;
            border-left: 4px solid var(--warning);
            padding: 20px;
            margin: 20px 0;
            border-radius: 6px;
        }
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .result {
            margin-top: 25px;
            padding: 20px;
            border-radius: 8px;
            display: none;
        }
        .test-data {
            background: #f9fafb;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            padding: 20px;
            font-family: monospace;
            font-size: 14px;
            margin: 15px 0;
        }
        .email-preview {
            background: #f3f4f6;
            border: 2px solid #d1d5db;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        .email-header {
            background: #e5e7eb;
            margin: -20px -20px 15px -20px;
            padding: 15px 20px;
            border-radius: 10px 10px 0 0;
            font-weight: bold;
            color: var(--secondary);
        }
        .checklist {
            list-style: none;
            padding: 0;
        }
        .checklist li {
            padding: 8px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .checklist li::before {
            content: "‚è≥";
            font-size: 18px;
        }
        .checklist li.success::before {
            content: "‚úÖ";
        }
        .checklist li.error::before {
            content: "‚ùå";
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Test Enhanced Email System</h1>
        
        <div class="info-box">
            <p><strong>Testing the enhanced FormSubmit email integration</strong> for The Up And Up Chess Club enrollment forms.</p>
            <p>This will submit a realistic test enrollment to verify that all email confirmations and notifications are working correctly.</p>
        </div>
        
        <div class="test-section">
            <h3>üìß Email Testing Plan</h3>
            <p>When we submit the test enrollment, the system should:</p>
            <ul class="checklist" id="checklist">
                <li id="check-1">Submit enrollment data to Supabase database</li>
                <li id="check-2">Send professional confirmation email to parent</li>
                <li id="check-3">Send detailed notification to hall.truth@gmail.com</li>
                <li id="check-4">Send copy notification to theuauchessclub@gmail.com</li>
                <li id="check-5">Provide auto-response confirmation</li>
            </ul>
        </div>
        
        <div class="test-section">
            <h3>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Test Enrollment Data</h3>
            <div class="test-data">
<strong>STUDENT:</strong>
‚Ä¢ Name: Emma Rodriguez
‚Ä¢ Age: 10 years old
‚Ä¢ Grade: 5th Grade
‚Ä¢ School: Washington Elementary
‚Ä¢ Experience: Knows basic moves
‚Ä¢ Interests: Strategy games, puzzles, math competitions

<strong>PARENT:</strong>
‚Ä¢ Name: Maria Rodriguez
‚Ä¢ Email: hall.truth@gmail.com (for testing)
‚Ä¢ Phone: (555) 123-4567
‚Ä¢ Address: 123 Chess Lane, Bethesda, MD 20814
‚Ä¢ Emergency: Carlos Rodriguez - (555) 765-4321

<strong>PROGRAM:</strong>
‚Ä¢ Level: Private Essentials ($349/month)
‚Ä¢ Format: In-Person Individual Lessons
‚Ä¢ Schedule: Weekends Morning
‚Ä¢ Goals: Learn tournament play and improve strategic thinking
‚Ä¢ Special: None
‚Ä¢ How heard: School recommendation
            </div>
        </div>
        
        <div class="test-section">
            <h3>üöÄ Execute Test</h3>
            <p>Click the button below to submit a realistic test enrollment and verify the email system:</p>
            
            <button onclick="executeEmailTest()" id="testBtn">
                <span>üß™ Submit Test Enrollment</span>
            </button>
            
            <button onclick="testFormSubmitOnly()" id="formSubmitBtn">
                <span>üìß Test FormSubmit Only</span>
            </button>
            
            <button onclick="checkEmailDelivery()" id="checkBtn">
                <span>üì¨ Check Email Delivery</span>
            </button>
        </div>
        
        <div class="expected-emails">
            <h3>üì¨ Expected Email Results</h3>
            
            <div class="email-preview">
                <div class="email-header">Parent Confirmation Email Preview</div>
                <div><strong>To:</strong> hall.truth@gmail.com (parent receives primary copy)</div>
                <div><strong>CC:</strong> hall.truth@gmail.com (club receives copy)</div>
                <div><strong>Subject:</strong> Chess Club Enrollment Confirmation - Emma Rodriguez</div>
                <div><strong>Template:</strong> Professional Box Style</div>
                <br>
                <div><strong>Content Preview:</strong></div>
                <div style="font-style: italic; margin-top: 10px;">
                    "Dear Maria Rodriguez,<br><br>
                    Thank you for enrolling Emma Rodriguez in The Up And Up Chess Club!<br><br>
                    ENROLLMENT CONFIRMATION DETAILS:<br>
                    ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ<br><br>
                    STUDENT INFORMATION:<br>
                    ‚Ä¢ Student Name: Emma Rodriguez<br>
                    ‚Ä¢ Age: 10 years old<br>
                    ‚Ä¢ Current Grade: 5th Grade..."
                </div>
            </div>
            
            <div class="email-preview">
                <div class="email-header">Club Notification Email Preview</div>
                <div><strong>To:</strong> theuauchessclub@gmail.com</div>
                <div><strong>CC:</strong> hall.truth@gmail.com</div>
                <div><strong>Subject:</strong> New Private Enrollment: Emma Rodriguez</div>
                <div><strong>Template:</strong> Table Style</div>
                <br>
                <div><strong>Content Preview:</strong></div>
                <div style="font-style: italic; margin-top: 10px;">
                    "NEW PRIVATE ENROLLMENT RECEIVED!<br><br>
                    Student: Emma Rodriguez (Age: 10)<br>
                    Parent: Maria Rodriguez<br>
                    Email: hall.truth@gmail.com<br>
                    Phone: (555) 123-4567<br><br>
                    Program: Private Essentials - $349/month<br>
                    Format: In-Person Individual Lessons..."
                </div>
            </div>
        </div>
        
        <div id="result" class="result"></div>
        
        <div class="warning-box">
            <h4>‚ö†Ô∏è Test Notes</h4>
            <ul>
                <li><strong>Email Timing:</strong> FormSubmit emails can take 5-10 minutes to arrive</li>
                <li><strong>Spam Check:</strong> Check spam folders for initial deliveries</li>
                <li><strong>Test Email:</strong> Using hall.truth@gmail.com as test recipient</li>
                <li><strong>Real Data:</strong> This creates a real database entry and sends actual emails</li>
                <li><strong>Verification:</strong> Check both Gmail accounts for email delivery</li>
            </ul>
        </div>
    </div>

    <script>
        // Import Supabase client
        const SUPABASE_URL = 'https://qhfkzvqxvqtfevqblhxi.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFoZmt6dnF4dnF0ZmV2cWJsaHhpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzMxNjkxMjksImV4cCI6MjA0ODc0NTEyOX0.J6zPl-wjuYSHH2-DjSrvz-M2Hm9o6RKGfyv7qKTF-QI';
        
        // Initialize Supabase
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        async function executeEmailTest() {
            const testBtn = document.getElementById('testBtn');
            const result = document.getElementById('result');
            
            testBtn.disabled = true;
            testBtn.innerHTML = '<span class="spinner"></span> Submitting Test...';
            result.style.display = 'none';
            
            try {
                showLoading('Executing comprehensive email test...');
                
                // Test enrollment data
                const enrollmentData = {
                    enrollment_type: 'private',
                    student_first_name: 'Emma',
                    student_last_name: 'Rodriguez',
                    student_age: '10',
                    student_grade: '5th Grade',
                    student_school: 'Washington Elementary',
                    chess_experience: 'Knows basic moves',
                    student_interests: 'Strategy games, puzzles, math competitions',
                    parent_first_name: 'Maria',
                    parent_last_name: 'Rodriguez',
                    parent_email: 'hall.truth@gmail.com',
                    parent_phone: '(555) 123-4567',
                    address: '123 Chess Lane',
                    city: 'Bethesda',
                    zip: '20814',
                    emergency_contact: 'Carlos Rodriguez - (555) 765-4321',
                    program_level: 'Private Essentials - $349/month',
                    session_format: 'In-Person Individual Lessons',
                    preferred_schedule: 'Weekends Morning',
                    learning_goals: 'Learn tournament play and improve strategic thinking',
                    special_considerations: 'None',
                    how_heard: 'School recommendation',
                    enrollment_date: new Date().toISOString()
                };
                
                updateChecklist('check-1', 'loading');
                
                // 1. Submit to database
                const { data, error } = await supabase
                    .from('private_enrollments')
                    .insert([enrollmentData])
                    .select();
                
                if (error) {
                    updateChecklist('check-1', 'error');
                    throw new Error('Database submission failed: ' + error.message);
                }
                
                updateChecklist('check-1', 'success');
                updateChecklist('check-2', 'loading');
                
                // 2. Send FormSubmit confirmation emails
                await sendTestFormSubmitEmails(enrollmentData);
                
                updateChecklist('check-2', 'success');
                updateChecklist('check-3', 'success');
                updateChecklist('check-4', 'success');
                updateChecklist('check-5', 'success');
                
                showSuccess('Email test completed successfully!', 
                    'Check hall.truth@gmail.com and theuauchessclub@gmail.com for test emails. They may take 5-10 minutes to arrive.');
                
            } catch (error) {
                console.error('Email test error:', error);
                showError('Email test failed', error.message);
                updateChecklist('check-2', 'error');
                updateChecklist('check-3', 'error');
                updateChecklist('check-4', 'error');
                updateChecklist('check-5', 'error');
            } finally {
                testBtn.disabled = false;
                testBtn.innerHTML = '<span>üß™ Submit Test Enrollment</span>';
            }
        }
        
        async function sendTestFormSubmitEmails(enrollmentData) {
            const studentName = `${enrollmentData.student_first_name} ${enrollmentData.student_last_name}`;
            const parentName = `${enrollmentData.parent_first_name} ${enrollmentData.parent_last_name}`;
            
            // Parent confirmation email
            const emailMessage = `Dear ${parentName},

Thank you for enrolling ${studentName} in The Up And Up Chess Club!

ENROLLMENT CONFIRMATION DETAILS:
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

STUDENT INFORMATION:
‚Ä¢ Student Name: ${studentName}
‚Ä¢ Age: ${enrollmentData.student_age} years old
‚Ä¢ Current Grade: ${enrollmentData.student_grade}
‚Ä¢ School: ${enrollmentData.student_school}
‚Ä¢ Chess Experience: ${enrollmentData.chess_experience}

PROGRAM DETAILS:
‚Ä¢ Program Level: ${enrollmentData.program_level}
‚Ä¢ Session Format: ${enrollmentData.session_format}
‚Ä¢ Preferred Schedule: ${enrollmentData.preferred_schedule}
‚Ä¢ Learning Goals: ${enrollmentData.learning_goals}

PARENT/GUARDIAN CONTACT:
‚Ä¢ Name: ${parentName}
‚Ä¢ Email: ${enrollmentData.parent_email}
‚Ä¢ Phone: ${enrollmentData.parent_phone}
‚Ä¢ Address: ${enrollmentData.address}, ${enrollmentData.city} ${enrollmentData.zip}
‚Ä¢ Emergency Contact: ${enrollmentData.emergency_contact}

NEXT STEPS:
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

We will contact you within 24 hours to:
1. Schedule your first personalized chess session
2. Provide program materials and preparation information
3. Discuss ${enrollmentData.student_first_name}'s specific learning goals
4. Answer any questions about our chess curriculum

CONTACT INFORMATION:
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

üìß Email: theuauchessclub@gmail.com
üìû Phone: (240) 360-0809

We're excited to help ${enrollmentData.student_first_name} develop their chess skills!

Best regards,
Truth Hall
Founder & Lead Instructor
The Up And Up Chess Club

*** THIS IS A TEST EMAIL ***`;

            // Send parent confirmation (parent as primary recipient)
            const parentFormData = new FormData();
            parentFormData.append('name', 'The Up And Up Chess Club');
            parentFormData.append('email', 'theuauchessclub@gmail.com');
            parentFormData.append('_subject', `TEST: Chess Club Enrollment Confirmation - ${studentName}`);
            parentFormData.append('message', emailMessage);
            parentFormData.append('_template', 'box');
            parentFormData.append('_captcha', 'false');
            parentFormData.append('_cc', 'hall.truth@gmail.com');
            parentFormData.append('_autoresponse', 'TEST: Thank you for enrolling with The Up And Up Chess Club! This is a test confirmation.');

            const parentResponse = await fetch(`https://formsubmit.co/ajax/${enrollmentData.parent_email}`, {
                method: 'POST',
                body: parentFormData
            });
            
            const parentResult = await parentResponse.json();
            console.log('Parent email result:', parentResult);

            // Club notification email
            const clubMessage = `TEST ENROLLMENT RECEIVED!

Student: ${studentName} (Age: ${enrollmentData.student_age})
Parent: ${parentName}
Email: ${enrollmentData.parent_email}
Phone: ${enrollmentData.parent_phone}

Program: ${enrollmentData.program_level}
Format: ${enrollmentData.session_format}
Schedule: ${enrollmentData.preferred_schedule}

School: ${enrollmentData.student_school}
Experience: ${enrollmentData.chess_experience}
Goals: ${enrollmentData.learning_goals}

Emergency Contact: ${enrollmentData.emergency_contact}
Address: ${enrollmentData.address}, ${enrollmentData.city} ${enrollmentData.zip}

Special Considerations: ${enrollmentData.special_considerations}
How They Heard: ${enrollmentData.how_heard}

ACTION REQUIRED: Contact parent within 24 hours to schedule first session.

Enrollment Time: ${new Date().toLocaleString()}

*** THIS IS A TEST ENROLLMENT ***`;

            const clubFormData = new FormData();
            clubFormData.append('name', parentName);
            clubFormData.append('email', 'theuauchessclub@gmail.com');
            clubFormData.append('_subject', `TEST: New Private Enrollment - ${studentName}`);
            clubFormData.append('message', clubMessage);
            clubFormData.append('_template', 'table');
            clubFormData.append('_captcha', 'false');

            const clubResponse = await fetch('https://formsubmit.co/ajax/theuauchessclub@gmail.com', {
                method: 'POST',
                body: clubFormData
            });
            
            const clubResult = await clubResponse.json();
            console.log('Club email result:', clubResult);
        }
        
        async function testFormSubmitOnly() {
            const formSubmitBtn = document.getElementById('formSubmitBtn');
            const result = document.getElementById('result');
            
            formSubmitBtn.disabled = true;
            formSubmitBtn.innerHTML = '<span class="spinner"></span> Testing FormSubmit...';
            result.style.display = 'none';
            
            try {
                showLoading('Testing FormSubmit service only...');
                
                const formData = new FormData();
                formData.append('name', 'Chess Club Test');
                formData.append('email', 'hall.truth@gmail.com');
                formData.append('_subject', 'FormSubmit Service Test');
                formData.append('message', `FormSubmit service test from Chess Club website.

This is a simple test to verify that FormSubmit.co is working correctly.

Test time: ${new Date().toLocaleString()}

If you receive this email, the FormSubmit service is functioning properly for the chess club email system.`);
                formData.append('_template', 'box');
                formData.append('_captcha', 'false');
                formData.append('_autoresponse', 'FormSubmit test completed successfully!');

                const response = await fetch('https://formsubmit.co/ajax/hall.truth@gmail.com', {
                    method: 'POST',
                    body: formData
                });
                
                const result_data = await response.json();
                
                if (response.ok && result_data.success === "true") {
                    showSuccess('FormSubmit test successful!', 
                        'Check hall.truth@gmail.com for the test email in the next 5-10 minutes.');
                } else {
                    showError('FormSubmit test failed', 
                        `Response: ${result_data.message || 'Unknown error'}`);
                }
                
            } catch (error) {
                showError('FormSubmit test error', error.message);
            } finally {
                formSubmitBtn.disabled = false;
                formSubmitBtn.innerHTML = '<span>üìß Test FormSubmit Only</span>';
            }
        }
        
        function checkEmailDelivery() {
            showSuccess('Email delivery check', 
                `Please check the following email accounts for test messages:
                
                ‚Ä¢ hall.truth@gmail.com (primary test recipient)
                ‚Ä¢ theuauchessclub@gmail.com (club notifications)
                
                Look for emails with subjects:
                ‚Ä¢ "TEST: Chess Club Enrollment Confirmation - Emma Rodriguez"
                ‚Ä¢ "TEST: New Private Enrollment - Emma Rodriguez"
                ‚Ä¢ "FormSubmit Service Test"
                
                Remember to check spam folders if emails don't appear in inbox.
                FormSubmit emails can take 5-10 minutes to deliver.`);
        }
        
        function updateChecklist(checkId, status) {
            const item = document.getElementById(checkId);
            if (!item) return;
            
            item.className = status;
            if (status === 'loading') {
                item.innerHTML = item.innerHTML.replace(/^[‚è≥‚úÖ‚ùå]\s*/, '‚è≥ ');
            } else if (status === 'success') {
                item.innerHTML = item.innerHTML.replace(/^[‚è≥‚úÖ‚ùå]\s*/, '‚úÖ ');
            } else if (status === 'error') {
                item.innerHTML = item.innerHTML.replace(/^[‚è≥‚úÖ‚ùå]\s*/, '‚ùå ');
            }
        }
        
        function showLoading(message) {
            const result = document.getElementById('result');
            result.className = 'result info-box';
            result.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span class="spinner"></span>
                    <span>${message}</span>
                </div>
            `;
            result.style.display = 'block';
        }
        
        function showSuccess(title, message) {
            const result = document.getElementById('result');
            result.className = 'result success-box';
            result.innerHTML = `
                <h4>‚úÖ ${title}</h4>
                <p style="white-space: pre-line;">${message}</p>
            `;
            result.style.display = 'block';
        }
        
        function showError(title, message) {
            const result = document.getElementById('result');
            result.className = 'result error-box';
            result.innerHTML = `
                <h4>‚ùå ${title}</h4>
                <p>${message}</p>
            `;
            result.style.display = 'block';
        }
    </script>
    
    <!-- Load Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</body>
</html>